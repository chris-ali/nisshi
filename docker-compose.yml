version: '3'

services:
  db:
    image: ${MYSQL_IMAGE}
    restart: always
    env_file: ./.env
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PW}
    volumes:
     - dbdata:/var/lib/mysql
     - ./Database:/docker-entrypoint-initdb.d
    ports:
     - "${MYSQL_LOCAL_PORT}:${MYSQL_DOCKER_PORT}"

  nisshi:
    depends_on:
     - db
    build: .
    env_file: ./.env
    environment:
     - ASPNETCORE_Nisshi_DatabaseProvider=${ASPNETCORE_Nisshi_DatabaseProvider}
     - ASPNETCORE_Nisshi_ConnectionString=${ASPNETCORE_Nisshi_ConnectionString}
    ports:
     - ${NISSHI_LOCAL_PORT}:${NISSHI_DOCKER_PORT}  

volumes:
  dbdata: